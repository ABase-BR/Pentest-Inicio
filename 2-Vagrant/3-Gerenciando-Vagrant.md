# Gerenciando o Vagrant no Linux
As opções podem variar dependendo da versão do **Vagrant** , vamos iniciar nossa primeira maquina.


## Criando maquina com o Vagrant
No terminal do seu linux abra o terminal e crie um diretório chamado **testevm**.
```sh
 mkdir testevm
```

Com um editor de sua preferencia crie um arquivo chamado **Vagrantfile** , no meu caso eu prefiro usar o **nano**.
```sh
 nano Vagrantfile
```

Para se familiarizar com o código vamos escrever ele

```sh
#	-*-	mode:	ruby	-*-
#	vi:	set	ft=ruby	:
VAGRANTFILE_API_VERSION	=	"2"
Vagrant.configure(VAGRANTFILE_API_VERSION)	do	|config|
	config.vm.define	"testvm"	do	|testvm|
		testvm.vm.box	=	"ubuntu/trusty64"
		testvm.vm.network	"public_network", ip: "192.168.0.24"
	end
	config.vm.provider	"virtualbox"	do	|v|
		v.customize	["modifyvm",	:id,	"--memory",	"1024"]
	end
end
```

Vamos salvar nosso arquivo (não esqueça de salvar) e saia do editor que você está usando.

## Vagrant up
Vamos agora iniciar nossa maquina , ainda em nosso terminal vamos fazer um
```sh
 vagrant up
```

Vamos prestar atenção em quanto tempo a nossa maquina está demorando para iniciar , dependendo de sua configuração da maquina pode demorar um pouco.

## Vagrant ssh
Para iniciar vamos realizar o seguinte comando
```sh
 vagrant up
```

Nesse caso podemos usar nossa maquina tranquilamente , podemos executar o comando **top** para ver os processos e examinar o diretorio **/etc** e instalar alguns pacotes manualmente.
```sh
 top
```

## mount point
Ainda dentro de nossa maquina podemos digitar
```sh
 cd /vagrant
```

Podemos ver que o seu **diretório** foi mapeado como um **mount point** dentro da maquina virtual.

Podemos usar outro nome de **diretório** que nesse caso se chama **vagrant** para isso precisamos inserir no arquivo de configuração do **Vagrantfile**.

## Destruindo maquina virtual
Podemos destruir nossa maquina virtual simplesmente digitando o comando
```sh
 vagrant destroy
```

E em seguida apertando o **Y** quando perguntado se pode realmente destruir a sua maquina virtual.

## Rapidez em criar Maquinas Virtuais com Vagrant
Sem colocar na balança o poder de sua maquina e nem a sua capacidade digitando o código podemos ver que criando uma maquina passo a passo no **Virtualbox** são diversos passos e isso para alguns pode ser grande , agora somando o tempo do **Virtualbox** e o download do CD de instalação e se caso apagar a maquina virtual vamos ter que passar passo a passo novamente temos um procedimento longo a ser repetido.

Agora usando o **Vagrantfile** podemos apenas subir **up** a mesma maquina diversas vezes sem utilizar a interface do **Virtualbox**.

## Vagrantfile e suas versões
Podemos versionar o arquivo Vagrantfile , este arquivo é responsável por descrever nossa maquina virtual junto com o código fonte , e quando for mudar a configuração de memoria está mudança estará no histórico junto as mudanças de código.

Podemos medir quanto tempo leva para subir uma nova maquina virtual utilizando o Vagrant , agora que a imagem está gravada em nossa maquina.

Vale lembrar que essa **cache de imagens** é muito importante em momentos que vamos precisar criar e destruir maquinas rapidamente.

**Recordando**

## Subindo maquina Vagrant
Podemos subir uma maquina usando
```sh
 vagrant up
```

## Conectando maquina Vagrant
Podemos nos conectar em nossa maquina usando
```sh
 vagrant ssh
```

## Destruindo maquina Vagrant
Podemos simplesmente destruir uma maquina com o comando
```sh
 vagrant destroy
```

## Vagrantfile
O **Vagrant** e a sua configuração utilizam o **Ruby** , existem versões distintas de APIS e vamos ultilizar a **versão 2**.

Dentro de uma instancia da configuração podemos definir as maquinas e suas caracteristicas , em um bloco de codigo Ruby.

**Código comentado**

```sh
#	-*-	mode:	ruby	-*-
#	vi:	set	ft=ruby	:
#	as	linhas	acima	indicam	a	linguagem	para	o	editor	de	texto
VAGRANTFILE_API_VERSION	=	"2"									#	versão	da	API	do	Vagrant
#	Este	bloco	de	ruby	contém	todas	as	atividades	que	o	Vagrant
#	deve	executar	representadas	pelo	objeto	que	chamei	de	config
Vagrant.configure(VAGRANTFILE_API_VERSION)	do	|config|
	#config.vm	cria	um	objeto	que	descreve	uma	máquina	virtual.
	#Chamei	esta	vm	de	"testevm"	e	quero	utilizar	o	Ubuntu	Trusty
	#Indiquei	que	quero	um	IP	privado	para	esta	máquina
	config.vm.define	"testvm"	do	|testvm|
		testvm.vm.box	=	"ubuntu/trusty64"
		testvm.vm.network	:private_network,	ip:	"192.168.33.2 "
	end
	#Este	bloco	me	dá	acesso	ao	provedor	da	máquina	virtual
	#(VirtualBox)
	#Configurei	esta	máquina	com	1GB	de	memória
	config.vm.provider	"virtualbox"	do	|v|
		v.customize	["modifyvm",	:id,	"--memory",	"1024"]
	end
end
```

Desse código acima eu falei sobre minha maquina virtual e descrevi que gostaria de usar o **Ubuntu Trusty 14.04** de 64 Bits. O **Vagrant** fornece algumas imagens e tem uma grande comunidade que permite os usuários compartilharem as suas imagens customizadas. É importante notar que ele cria uma biblioteca local com as imagens que vamos utilizar , assim sendo o , o custo de fazer download da imagem é amortizado entre as vezes em que você sobe e destroi as maquinas virtuais.

## Box o que é ?
O nome que o Vagrant da as imagens no ecossistema do Vagrant é **Box** ou Boxes.

Vamos utilizar o **Box** chamado de **Base Box** , por ser uma imagens que eles mantem só com o sistema operacional.

## Desativando VM Vagrant
Podemos desativa-la usando o comando
```sh
 vagrant halt
```

## Servidor NGINX com Vagrant
Podemos entrar em nosso terminal e dar o comando
```sh
 vagrant up
```

Em seguida precisamos conectar com o
```sh
 vagrant ssh
```

Após ter certeza que está em sua VM Vagrant vamos realizar os comandos abaixo (usaremos o comando SUDO para maior segurança)
```sh
 sudo apt-get update
 sudo apt-get install nginx
```

Vamos abrir um navegador e inserir o endereço que inserimos para nosso endereço de IP no arquivo de configuração do **Vagrant** , após entrar vamos ver a mensagem de boas vindas do **NGINX**. Vamos voltar ao terminal e digitar o comando
```sh
 sudo -s
 echo "GrowBR" > /usr/share/nginx/html/index.html
```

Voltando para o navegador vemos que está da mesma forma, vamos atualizar e ver o resultado. Se você fez certo o resultado era a mensagem **Grow BR**. Agora pense quais as outras configurações que podemos fazer alem de colocar um servidor web com uma mensagem servindo a frase **GrowBR**.

## Criando outra maquina com o Vagrantfile
Vamos modificar o Vagrantfile para utilizar está maquina , graças ao Vagrant caso errar alguma configuração podemos destruir a maquina e recriá-la do zero.

## Procurando outras maquinas
Podemos procurar outros sistemas operacionais e imagens criadas para o que você quiser. Entre no link
```sh
 https://atlas.hashicorp.com/boxes/search
```

## Referências
Caixa de Ferramentas DevOps - **Gleicon Moraes**
